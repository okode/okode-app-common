{"version":3,"sources":["../../src/providers/crashlytics.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,OAAO,EAAE,UAAA,EAAY,SAAA,EAAU,MAAO,eAAA,CAAgB;AACtD,OAAO,EAAE,QAAA,EAAU,iBAAA,EAAkB,MAAO,eAAA,CAAgB;AAC5D,OAAO,EAAE,YAAA,EAAa,MAAO,6BAAA,CAA8B;AAC3D,OAAO,KAAK,UAAA,MAAgB,eAAA,CAAgB;AAC5C,OAAO,EAAE,GAAA,EAAI,MAAO,OAAA,CAAQ;AAG5B;IAA6C,2CAAiB;IAE5D,iCACU,QAAkB,EAClB,YAA0B,EAC1B,GAAQ;QAHlB,YAKE,iBAAO,SACR;QALS,cAAQ,GAAR,QAAQ,CAAU;QAClB,kBAAY,GAAZ,YAAY,CAAc;QAC1B,SAAG,GAAH,GAAG,CAAK;;IAGlB,CAAC;IAED,6CAAW,GAAX,UAAY,KAAU;QACpB,EAAE,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAAC,MAAM,CAAC;QAAC,CAAC;QAChD,iBAAM,WAAW,YAAC,KAAK,CAAC,CAAC;QACzB,EAAE,CAAC,CAAC,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YACpD,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;QACxB,CAAC;IACH,CAAC;IAEO,2CAAS,GAAjB,UAAkB,KAAU;QAA5B,iBAsBC;QArBC,OAAO,CAAC,GAAG,CAAC,2EAA2E,CAAC,CAAC;QACzF,EAAE,CAAC,CAAC,OAAO,MAAM,IAAI,WAAW,CAAC,CAAC,CAAC;YACjC,EAAE,CAAC,CAAC,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC;gBAC3B,UAAU,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,UAAA,MAAM;oBACrC,EAAE,CAAC,CAAC,KAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;wBAChC,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CAAC;oBAC9D,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACN,IAAI,QAAQ,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC;wBAClE,IAAI,MAAM,GAAG,EAAE,CAAC;wBAChB,GAAG,CAAC,CAAc,UAAM,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAM;4BAAnB,IAAI,KAAK,eAAA;4BACZ,MAAM,IAAO,KAAK,CAAC,YAAY,SAAI,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,SAAI,KAAK,CAAC,UAAU,QAAK,CAAC;yBAClG;wBACD,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAI,KAAK,CAAC,IAAI,UAAK,KAAK,CAAC,OAAO,YAAO,MAAQ,CAAC,CAAC;oBACvF,CAAC;oBACD,KAAI,CAAC,wBAAwB,EAAE,CAAC;gBAClC,CAAC,CAAC,CAAC,KAAK,CAAC,UAAA,MAAM,IAAI,OAAA,OAAO,CAAC,GAAG,CAAC,qBAAqB,GAAG,MAAM,CAAC,EAA3C,CAA2C,CAAC,CAAC;YAClE,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,MAAM,CAAC,WAAW,CAAC,iBAAiB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC;gBAC5D,IAAI,CAAC,wBAAwB,EAAE,CAAC;YAClC,CAAC;QACH,CAAC;IACH,CAAC;IAEO,0DAAwB,GAAhC;QACE,OAAO,CAAC,GAAG,CAAC,yDAAyD,CAAC,CAAC;QACvE,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;QACzB,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;IAC3B,CAAC;IAEO,oDAAkB,GAA1B,UAA2B,KAAU;QACnC,EAAE,CAAC,CAAC,KAAK,IAAI,KAAK,CAAC,MAAM,IAAI,GAAG,CAAC;YAAC,MAAM,CAAC,IAAI,CAAC;QAC9C,MAAM,CAAC,KAAK,CAAC;IACf,CAAC;IAEO,qDAAmB,GAA3B,UAA4B,KAAU;QACpC,EAAE,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAAC,CAAC;QAC/C,IAAI,OAAO,GAAG,KAAK,CAAC,OAAO,CAAC;QAC5B;;;;WAIG;QACH,EAAE,CAAC,CACD,OAAO,CAAC,QAAQ,CAAC,+CAA+C,CAAC;YACjE,OAAO,CAAC,QAAQ,CAAC,qCAAqC,CAAC;YACvD,OAAO,CAAC,QAAQ,CAAC,0BAA0B,CAC7C,CAAC,CAAC,CAAC;YACD,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,8BAA4B,OAAS,CAAC,CAAC;YAClD,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QACD,MAAM,CAAC,KAAK,CAAC;IACf,CAAC;IAEI,kCAAU,GAA0B;QAC3C,EAAE,IAAI,EAAE,UAAU,EAAE;KACnB,CAAC;IACF,kBAAkB;IACX,sCAAc,GAAmE,cAAM,OAAA;QAC9F,EAAC,IAAI,EAAE,QAAQ,GAAG;QAClB,EAAC,IAAI,EAAE,YAAY,GAAG;QACtB,EAAC,IAAI,EAAE,GAAG,GAAG;KACZ,EAJ6F,CAI7F,CAAC;IACF,8BAAC;CAjFD,AAiFC,CAjF4C,iBAAiB,GAiF7D;SAjFY,uBAAuB","file":"crashlytics.js","sourceRoot":"","sourcesContent":["import { Injectable, isDevMode } from '@angular/core';\nimport { Platform, IonicErrorHandler } from 'ionic-angular';\nimport { SplashScreen } from '@ionic-native/splash-screen';\nimport * as StackTrace from 'stacktrace-js';\nimport { Log } from './log';\n\n\nexport class CrashlyticsErrorHandler extends IonicErrorHandler {\n\n  constructor(\n    private platform: Platform,\n    private splashScreen: SplashScreen,\n    private log: Log\n  ) {\n    super();\n  }\n\n  handleError(error: any) {\n    if (this.isIgnorableNavError(error)) { return; }\n    super.handleError(error);\n    if (!isDevMode() && !this.isAnIgnorableError(error)) {\n      this.sendError(error);\n    }\n  }\n\n  private sendError(error: any) {\n    console.log('TODO: Add block UI for preventing use while sending report to Crashlytics');\n    if (typeof fabric != 'undefined') {\n      if (error instanceof Error) {\n        StackTrace.fromError(error).then(frames => {\n          if (this.platform.is('android')) {\n            fabric.Crashlytics.sendNonFatalCrash(error.message, frames);\n          } else {\n            let baseHref = window.location.href.replace('www/index.html', '');\n            let report = '';\n            for (let frame of frames) {\n              report += `${frame.functionName}(${frame.fileName.replace(baseHref, '')}:${frame.lineNumber})\\n`;\n            }\n            fabric.Crashlytics.sendNonFatalCrash(`${error.name}: ${error.message}\\n\\n${report}`);\n          }\n          this.displayErrorMsgAndReload();\n        }).catch(reason => console.log('Crashlytics catch: ' + reason));\n      } else {\n        fabric.Crashlytics.sendNonFatalCrash(JSON.stringify(error));\n        this.displayErrorMsgAndReload();\n      }\n    }\n  }\n\n  private displayErrorMsgAndReload() {\n    console.log('The application has unexpectedly quit and will restart.');\n    this.splashScreen.show();\n    window.location.reload();\n  }\n\n  private isAnIgnorableError(error: any) {\n    if (error && error.status == 500) return true;\n    return false;\n  }\n\n  private isIgnorableNavError(error: any) {\n    if (!error ||Â !error.message) { return false; }\n    let message = error.message;\n    /**\n     * Messages got from:\n     * https://github.com/ionic-team/ionic/blob/ae4be669bb96de01ff2224ff36da89e9cde12c7f/src/navigation/nav-controller-base.ts#L322\n     *\n     */\n    if (\n      message.includes('navigation stack needs at least one root page') ||\n      message.includes('no views in the stack to be removed') ||\n      message.includes('removeView was not found')\n    ) {\n      this.log.e(`Ignoring Ionic nav error ${message}`);\n      return true;\n    }\n    return false;\n  }\n\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: Platform, },\n{type: SplashScreen, },\n{type: Log, },\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}